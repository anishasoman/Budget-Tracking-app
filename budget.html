<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>$pendee Budget</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    .editing-row {
      background-color: #fff8e1;
      transition: background-color 0.3s ease;
    }
    tr.fade-in {
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 text-white p-4 md:p-6 flex justify-between items-center">
    <h1 class="text-xl md:text-2xl font-bold ">$pendee</h1>
    <h1 id="welcomeMsg" class="text-xl font-bold text-white mb-4"></h1>
    <button id="logoutBtn" class="bg-green-600 px-3 py-2 md:px-4 rounded hover:bg-red-700 transition text-sm md:text-base">Logout</button>
  </header>

  <main class="flex flex-col md:flex-row flex-1 p-4 gap-4 overflow-y-auto">

    <!-- Left Section -->
    <section class="md:w-1/3 bg-white p-5 md:p-6 rounded-2xl shadow-lg flex-shrink-0">
      <h2 class="text-lg md:text-xl font-bold mb-4">Add/Edit Transaction</h2>
      <form id="transactionForm" class="space-y-4">
        <input type="hidden" id="editIndex">

        <div>
          <label class="block font-semibold">Type</label>
          <select id="type" class="w-full border rounded p-2">
            <option value="income">Income</option>
            <option value="expense">Expense</option>
          </select>
        </div>

        <div>
          <label class="block font-semibold">Category</label>
          <select id="category" class="w-full border rounded p-2"></select>
        </div>

        <div>
          <label class="block font-semibold">Amount</label>
          <input type="number" id="amount" placeholder="Amount" class="w-full border rounded p-2">
        </div>

        <div>
          <label class="block font-semibold">Description</label>
          <input type="text" id="description" placeholder="Description" class="w-full border rounded p-2">
        </div>

        <button type="submit" class="bg-gradient-to-r from-green-400 to-blue-500 text-white font-bold p-2 rounded w-full hover:scale-105 transition">
          Add Transaction
        </button>
      </form>
    </section>

    <!-- Right Section -->
    <section class="md:w-2/3 flex flex-col gap-4 w-full">

      <!-- Summary Boxes -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <div class="bg-gradient-to-r from-green-400 to-green-600 text-white rounded-2xl p-4 md:p-6 shadow-lg transform hover:scale-105 transition">
          <h3 class="font-bold text-base md:text-lg">Income</h3>
          <p id="incomeAmount" class="text-2xl md:text-3xl mt-2">₹0</p>
        </div>
        <div class="bg-gradient-to-r from-red-400 to-red-600 text-white rounded-2xl p-4 md:p-6 shadow-lg transform hover:scale-105 transition">
          <h3 class="font-bold text-base md:text-lg">Expenses</h3>
          <p id="expenseAmount" class="text-2xl md:text-3xl mt-2">₹0</p>
        </div>
        <div class="bg-gradient-to-r from-blue-400 to-blue-600 text-white rounded-2xl p-4 md:p-6 shadow-lg transform hover:scale-105 transition">
          <h3 class="font-bold text-base md:text-lg">Balance</h3>
          <p id="balanceAmount" class="text-2xl md:text-3xl mt-2">₹0</p>
        </div>
      </div>

      <!-- Pie Chart -->
      <div class="bg-white p-4 md:p-6 rounded-2xl shadow-lg">
        <h3 class="text-lg md:text-xl font-bold mb-3 md:mb-4">Expenses by Category</h3>
        <div class="relative w-full h-64 sm:h-72 md:h-80">
          <canvas id="expenseChart" class="!w-full !h-full"></canvas>
        </div>
      </div>
    </section>
  </main>

  <!-- FULL-WIDTH TRANSACTION TABLES -->
  <section class="w-full px-4 pb-6 space-y-6">
    <div class="bg-white rounded-2xl shadow-lg p-6 mt-8">
      <h3 class="text-2xl font-bold text-center text-gray-800 mb-6">Transaction Details</h3>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        
        <!-- Income Table -->
        <div class="bg-white p-4 md:p-6 rounded-2xl shadow-lg overflow-x-auto">
          <h3 class="text-lg md:text-xl font-bold mb-4 text-green-600">Income Transactions</h3>
          <table class="min-w-full text-left text-sm md:text-base">
            <thead>
              <tr class="bg-green-100 text-green-700">
                <th class="px-3 md:px-4 py-2">Date</th>
                <th class="px-3 md:px-4 py-2">Category</th>
                <th class="px-3 md:px-4 py-2">Amount</th>
                <th class="px-3 md:px-4 py-2">Description</th>
                <th class="px-3 md:px-4 py-2">Balance</th>
                <th class="px-3 md:px-4 py-2">Actions</th>
              </tr>
            </thead>
            <tbody id="incomeTable"></tbody>
          </table>
        </div>

        <!-- Expense Table -->
        <div class="bg-white p-4 md:p-6 rounded-2xl shadow-lg overflow-x-auto">
          <h3 class="text-lg md:text-xl font-bold mb-4 text-red-600">Expense Transactions</h3>
          <table class="min-w-full text-left text-sm md:text-base">
            <thead>
              <tr class="bg-red-100 text-red-700">
                <th class="px-3 md:px-4 py-2">Date</th>
                <th class="px-3 md:px-4 py-2">Category</th>
                <th class="px-3 md:px-4 py-2">Amount</th>
                <th class="px-3 md:px-4 py-2">Description</th>
                <th class="px-3 md:px-4 py-2">Balance</th>
                <th class="px-3 md:px-4 py-2">Actions</th>
              </tr>
            </thead>
            <tbody id="expenseTable"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <script>
    const transactionForm = document.getElementById('transactionForm');
    const incomeTable = document.getElementById('incomeTable');
    const expenseTable = document.getElementById('expenseTable');
    const incomeAmount = document.getElementById('incomeAmount');
    const expenseAmount = document.getElementById('expenseAmount');
    const balanceAmount = document.getElementById('balanceAmount');
    const editIndexInput = document.getElementById('editIndex');
    const typeSelect = document.getElementById('type');
    const categorySelect = document.getElementById('category');
    const logoutBtn = document.getElementById('logoutBtn');

    const incomeCategories = ["Salary", "Bonus", "Freelance", "Investment"];
    const expenseCategories = ["Food", "Rent", "Utilities", "Entertainment", "Transport", "Shopping", "Others"];

    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

    const username = localStorage.getItem("loggedInUser");
    if (username) {
      document.getElementById("welcomeMsg").textContent = `Welcome, ${username}...`;
    }

    function populateCategories() {
      const categories = typeSelect.value === "income" ? incomeCategories : expenseCategories;
      categorySelect.innerHTML = categories.map(c => `<option value="${c}">${c}</option>`).join('');
    }
    typeSelect.addEventListener('change', populateCategories);
    populateCategories();

    const ctx = document.getElementById('expenseChart').getContext('2d');
    let expenseChart = new Chart(ctx, {
      type: 'pie',
      data: { labels: [], datasets: [{ data: [], backgroundColor: [] }] },
      options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
    });

    function updateDashboard() {
      let income = transactions.filter(t => t.type === 'income').reduce((a, b) => a + b.amount, 0);
      let expense = transactions.filter(t => t.type === 'expense').reduce((a, b) => a + b.amount, 0);
      let balance = income - expense;

      incomeAmount.textContent = `₹${income}`;
      expenseAmount.textContent = `₹${expense}`;
      balanceAmount.textContent = `₹${balance}`;

      incomeTable.innerHTML = '';
      expenseTable.innerHTML = '';

      transactions.forEach((t, idx) => {
        const row = `
          <tr class="border-b fade-in">
            <td class="px-3 md:px-4 py-2">${t.date}</td>
            <td class="px-3 md:px-4 py-2">${t.category}</td>
            <td class="px-3 md:px-4 py-2 ${t.type === 'income' ? 'text-green-600' : 'text-red-600'} font-semibold">₹${t.amount}</td>
            <td class="px-3 md:px-4 py-2">${t.description}</td>
            <td class="px-3 md:px-4 py-2">₹${t.balance}</td>
            <td class="px-3 md:px-4 py-2 flex gap-2">
              <button onclick="editTransaction(${idx})" class="bg-yellow-400 text-white px-2 py-1 rounded hover:opacity-80">Edit</button>
              <button onclick="deleteTransaction(${idx})" class="bg-red-500 text-white px-2 py-1 rounded hover:opacity-80">Delete</button>
            </td>
          </tr>`;
        if (t.type === 'income') incomeTable.innerHTML += row;
        else expenseTable.innerHTML += row;
      });

      const categories = {};
      transactions.filter(t => t.type === 'expense').forEach(t => {
        categories[t.category] = (categories[t.category] || 0) + t.amount;
      });
      expenseChart.data.labels = Object.keys(categories);
      expenseChart.data.datasets[0].data = Object.values(categories);
      expenseChart.data.datasets[0].backgroundColor = Object.keys(categories).map((_, i) => `hsl(${i * 50 % 360},70%,60%)`);
      expenseChart.update();

      localStorage.setItem('transactions', JSON.stringify(transactions));
    }

    transactionForm.addEventListener('submit', e => {
      e.preventDefault();
      const type = typeSelect.value;
      const category = categorySelect.value;
      const amount = parseFloat(document.getElementById('amount').value);
      const description = document.getElementById('description').value;
      const date = new Date().toLocaleDateString();
      const editIndex = editIndexInput.value;

      if (!category || !amount) return;

      if (editIndex !== '') {
        transactions[editIndex] = { ...transactions[editIndex], type, category, amount, description };
        editIndexInput.value = '';
      } else {
        transactions.push({ date, type, category, amount, description, balance: 0 });
      }

      let runningBalance = 0;
      transactions.forEach(t => {
        runningBalance += t.type === 'income' ? t.amount : -t.amount;
        t.balance = runningBalance;
      });

      updateDashboard();
      transactionForm.reset();
      populateCategories();

      document.querySelectorAll("tr").forEach(row => row.classList.remove("editing-row"));
      const submitBtn = transactionForm.querySelector("button[type='submit']");
      submitBtn.textContent = "Add Transaction";
      submitBtn.classList.replace("from-yellow-400", "from-green-400");
      submitBtn.classList.replace("to-yellow-600", "to-blue-500");
    });

    function editTransaction(idx) {
      const t = transactions[idx];
      typeSelect.value = t.type;
      populateCategories();
      categorySelect.value = t.category;
      document.getElementById('amount').value = t.amount;
      document.getElementById('description').value = t.description;
      editIndexInput.value = idx;

      const submitBtn = transactionForm.querySelector("button[type='submit']");
      submitBtn.textContent = "Update Transaction";
      submitBtn.classList.replace("from-green-400", "from-yellow-400");
      submitBtn.classList.replace("to-blue-500", "to-yellow-600");

      document.querySelectorAll("tr").forEach(row => row.classList.remove("editing-row"));
      const allRows = document.querySelectorAll("tbody tr");
      if (allRows[idx]) allRows[idx].classList.add("editing-row");
    }

    function deleteTransaction(idx) {
      if (confirm("Are you sure you want to delete this transaction?")) {
        transactions.splice(idx, 1);
        updateDashboard();
      }
    }

    logoutBtn.addEventListener('click', () => {
      alert("Do You Want to Logout?")
      localStorage.clear();
      transactions = [];
      updateDashboard();
      window.location.href = "index.html";
    });

    updateDashboard();
  </script>
</body>
</html>
